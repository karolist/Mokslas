<HTML><HEAD><TITLE>Topic 28</TITLE></HEAD>

<BODY BGCOLOR="#FFFFFF" TEXT="#000000" LINK="#CC00CC" VLINK="#CC00CC" ALINK="#CC00CC">
<SCRIPT language="JavaScript">
<!--
if (document.location==parent.document.location)document.write("<CENTER><H3>This page is part of the Optimizing for Pentium(R) II and Pentium Pro Processors tutorial. To start the tutorial, please open the <a href=\"start.htm\">START.HTM</a> page in the same directory.</H3></CENTER>")
//--></SCRIPT>

<a name="1"></a><P><font size="+1"><b>П</b></font>риведенный в предыдущем уроке оптимизированный код, не содержащий ветвлений,может быть дополнительно оптимизирован для отдельных значений <FONT COLOR="#0000BF">C1</FONT>и<FONT COLOR="#0000BF"> C2</FONT>.<P><B>Пример:</B><BR>Данный пример демонстрирует применение следующих приемов оптимизации:<BR>&nbsp;<LI>&nbsp;Использование <FONT COLOR="#3333FF">SBB</FONT> вместо <FONT COLOR="#3333FF">SETcc</FONT>.</LI><LI>&nbsp;Замена условий в <FONT COLOR="#3333FF">SETcc</FONT> на противоположные.</LI><LI>&nbsp;Использование <FONT COLOR="#3333FF">LEA</FONT> вместо последовательности<FONT COLOR="#3333FF">DEC</FONT>, <FONT COLOR="#3333FF">ADD</FONT>, <FONT COLOR="#3333FF">AND.</FONT></LI><LI>&nbsp;Устранение бесполезных команд.</LI><BR>&nbsp;<BR><font size="+1"><b>Н</b></font>ажатием на стрелку <img src="images/bluarrow.gif"> 
выберите одно из условий, чтобы посмотреть, как применяются данныеприемы при выполнении этого условия.<P><B>Замечание:</B><BR>Команда <FONT COLOR="#3333FF">XOR EBX</FONT>,<FONT COLOR="#3333FF">EBX </FONT><FONT COLOR="#000000">предотвращает </FONT><A HREF="javascript:parent.showglos('partregstall')"><FONT COLOR="#CC33CC">задержку в связи с использованием 16-разрядного регистра</FONT></A>.<BR><BR><BR><BR><BR><BR><BR><BR><BR><BR><BR><BR><BR><BR><BR><BR><BR><BR><BR><BR><a name="2"></a><FONT COLOR="#000000">В случае </FONT><FONT COLOR="#0000BF">C1</FONT><FONT COLOR="#000000">=-1 и </FONT><FONT COLOR="#0000BF">C2</FONT><FONT COLOR="#000000">=0 замените </FONT><FONT COLOR="#0000BF">SETGE</FONT><FONT COLOR="#000000"> на </FONT><FONT COLOR="#0000BF">SBB</FONT><FONT COLOR="#000000">. Затем удалите три последние команды.</FONT> <BR><FONT COLOR="#0000BF">SBB</FONT><FONT COLOR="#000000"> использует флаг </FONT><FONT COLOR="#0000BF">CF</FONT><FONT COLOR="#000000">, ранее установленный командой </FONT><FONT COLOR="#0000BF">CMP </FONT><FONT COLOR="#000000">и устанавливает </FONT><FONT COLOR="#0000BF">EBX</FONT><FONT COLOR="#000000"> в -1 (</FONT><FONT COLOR="#0000BF">C1</FONT><FONT COLOR="#000000">) при </FONT><FONT COLOR="#0000BF">A</FONT><FONT COLOR="#000000"> &lt; </FONT><FONT COLOR="#0000BF">B</FONT><FONT COLOR="#000000">,и в 0 (</FONT><FONT COLOR="#0000BF">C2</FONT><FONT COLOR="#000000">) при </FONT><FONT COLOR="#0000BF">A</FONT><FONT COLOR="#000000"> >= </FONT><FONT COLOR="#0000BF">B</FONT><FONT COLOR="#000000">.</FONT><BR><BR><A HREF="#1">К началу страницы</A><BR><BR><BR><BR><BR><BR><BR><BR><BR><BR><BR><BR><BR><BR><BR><BR><BR><BR><BR><BR><BR><BR><BR><BR><BR><BR><BR><BR><A NAME="3"></a><FONT COLOR="#000000">В случае </FONT><FONT COLOR="#0000BF">C1</FONT><FONT COLOR="#000000">=0 и </FONT><FONT COLOR="#0000BF">C2</FONT><FONT COLOR="#000000">=1 удалите три последние команды. </FONT><FONT COLOR="#0000BF">SETGE</FONT><FONT COLOR="#000000"> устанавливает </FONT><FONT COLOR="#0000BF">BL</FONT><FONT COLOR="#000000"> в 0 (</FONT><FONT COLOR="#0000BF">C1</FONT><FONT COLOR="#000000">) при </FONT><FONT COLOR="#0000BF">A</FONT><FONT COLOR="#000000"> &lt; </FONT><FONT COLOR="#0000BF">B</FONT><FONT COLOR="#000000">, и 1 (</FONT><FONT COLOR="#0000BF">C2</FONT><FONT COLOR="#000000">) при </FONT><FONT COLOR="#0000BF">A</FONT><FONT COLOR="#000000"> >= </FONT><FONT COLOR="#0000BF">B</FONT><FONT COLOR="#000000">.</FONT><BR><BR><A HREF="#1">К началу страницы</A><BR><BR><BR><BR><BR><BR><BR><BR><BR><BR><BR><BR><BR><BR><BR><BR><BR><BR><BR><BR><BR><BR><BR><BR><BR><BR><BR><BR><A NAME="4"></a><FONT COLOR="#000000">В случае </FONT><FONT COLOR="#0000BF">C2</FONT><FONT COLOR="#000000">=0 удалите последнюю команду. Она прибавляет 0 (</FONT><FONT COLOR="#0000BF">C2</FONT><FONT COLOR="#000000">)  к </FONT><FONT COLOR="#0000BF">EBX</FONT><FONT COLOR="#000000">.</FONT><BR><BR><A HREF="#1">К началу страницы</A><BR><BR><BR><BR><BR><BR><BR><BR><BR><BR><BR><BR><BR><BR><BR><BR><BR><BR><BR><BR><BR><BR><BR><BR><BR><BR><BR><BR><A NAME="5"></a><FONT COLOR="#000000">В случае </FONT><FONT COLOR="#0000BF">C2-C1</FONT><FONT COLOR="#000000">= 1, 2, 4 или 8 замените три последние команды на </FONT><FONT COLOR="#0000BF">LEA</FONT><FONT COLOR="#000000">.</FONT><FONT COLOR="#0000BF"> SETGE</FONT><FONT COLOR="#000000"> устанавливает </FONT><FONT COLOR="#0000BF">BL</FONT><FONT COLOR="#000000"> в 0 при </FONT><FONT COLOR="#0000BF">A</FONT><FONT COLOR="#000000">&lt; </FONT><FONT COLOR="#0000BF">B&nbsp;</FONT><FONT COLOR="#000000">и в 1 при </FONT><FONT COLOR="#0000BF">A</FONT><FONT COLOR="#000000"> >=</FONT><FONT COLOR="#0000BF">B</FONT><FONT COLOR="#000000">. При </FONT><FONT COLOR="#0000BF">BL</FONT><FONT COLOR="#000000">= 0&nbsp; </FONT><FONT COLOR="#0000BF">LEA</FONT><FONT COLOR="#000000"> устанавливает  </FONT><FONT COLOR="#0000BF">EBX</FONT><FONT COLOR="#000000"> в </FONT><FONT COLOR="#0000BF">0*(C2-C1)+C1</FONT><FONT COLOR="#000000">= </FONT><FONT COLOR="#0000BF">C1</FONT><FONT COLOR="#000000">. При </FONT><FONT COLOR="#0000BF">BL</FONT><FONT COLOR="#00000">= 1 </FONT><FONT COLOR="#0000BF">LEA</FONT><FONT COLOR="#000000"> устанавливает </FONT><FONT COLOR="#0000BF">EBX</FONT><FONT COLOR="#000000"> в </FONT><FONT COLOR="#0000BF">1*(C2-C1)+C1</FONT><FONT COLOR="#000000">= </FONT><FONT COLOR="#0000BF">C2</FONT><FONT COLOR="#000000">.</FONT><BR><BR><A HREF="#1">К началу страницы</A><BR><BR><BR><BR><BR><BR><BR><BR><BR><BR><BR><BR><BR><BR><BR><BR><BR><BR><BR><BR><BR><BR><BR><BR><BR><BR><BR><BR><A NAME="6"></a><FONT COLOR="#000000">В случае, когда команды находятся в теле цикла, замените три последние команды на </FONT><FONT COLOR="#0000BF">mov ebx,TABLE [ebx*4]. </FONT><BR><FONT COLOR="#0000BF">TABLE</FONT><FONT COLOR="#000000"> содержит константы </FONT><FONT COLOR="#0000BF">C1</FONT><FONT COLOR="#000000"> и </FONT><FONT COLOR="#0000BF">C2</FONT><FONT COLOR="#000000">. В </FONT><FONT COLOR="#0000BF">EBX</FONT><FONT COLOR="#000000"> заносится значение, указанное в таблице </FONT><FONT COLOR="#0000BF">TABLE</FONT><FONT COLOR="#000000">. При первом доступе к </FONT><FONT COLOR="#0000BF">TABLE</FONT> может произойти промах в кэш<FONT COLOR="#000000">.</FONT><BR><BR><A HREF="#1">К началу страницы</A><BR><BR><BR><BR><BR><BR><BR><BR><BR><BR><BR><BR><BR><BR><BR><BR><BR><BR><BR><BR><BR><BR><BR><BR><BR><BR><BR><BR><BR><BR><BR><BR><A NAME="7"></a><FONT COLOR="#000000">При </FONT><FONT COLOR="#0000BF">C1</FONT><FONT COLOR="#000000">=1 и </FONT><FONT COLOR="#0000BF">C2</FONT><FONT COLOR="#000000">=0&nbsp; замените </FONT><FONT COLOR="#0000BF">SETGE</FONT><FONT COLOR="#000000"> на </FONT><FONT COLOR="#0000BF">ADC</FONT><FONT COLOR="#000000">. Затем удалите три последние команды. </FONT><BR><FONT COLOR="#0000BF">ADC</FONT><FONT COLOR="#000000"> использует флаг </FONT><FONT COLOR="#0000BF">CF, </FONT>ранее установленный командой <FONT COLOR="#0000BF">CMP, </FONT><FONT COLOR="#000000"> и устанавливает </FONT><FONT COLOR="#0000BF">EBX</FONT><FONT COLOR="#000000"> в 1 (</FONT><FONT COLOR="#0000BF">C1</FONT><FONT COLOR="#000000">) при </FONT><FONT COLOR="#0000BF">A</FONT><FONT COLOR="#000000"> &lt; </FONT><FONT COLOR="#0000BF">B&nbsp;</FONT><FONT COLOR="#000000"> и в 0 (</FONT><FONT COLOR="#0000BF">C2</FONT><FONT COLOR="#000000">) при </FONT><FONT COLOR="#0000BF">A</FONT><FONT COLOR="#000000"> >= </FONT><FONT COLOR="#0000BF">B</FONT><FONT COLOR="#000000">.</FONT><BR><BR><A HREF="#1">К началу страницы</A><BR><BR><BR><BR><BR><BR><BR><BR><BR><BR><BR><BR><BR><BR><BR><BR><BR><BR><BR><BR><BR><BR><BR><BR><BR><BR><BR><BR><BR><BR><BR><BR><A NAME="8"></a><FONT COLOR="#000000">При </FONT><FONT COLOR="#0000BF">C1</FONT><FONT COLOR="#000000">=0 замените </FONT><FONT COLOR="#0000BF">SETGE</FONT><FONT COLOR="#000000"> на </FONT><FONT COLOR="#0000BF">SETL и </FONT><FONT COLOR="#000000"> измените операнд команды </FONT><FONT COLOR="#0000BF">AND</FONT><FONT COLOR="#000000"> на </FONT><FONT COLOR="#0000BF">C2</FONT><FONT COLOR="#000000">. </FONT><BR><FONT COLOR="#000000">При </FONT><FONT COLOR="#0000BF">A</FONT><FONT COLOR="#000000">&lt; </FONT><FONT COLOR="#0000BF">B&nbsp;</FONT><FONT COLOR="#000000"></FONT><FONT COLOR="#0000BF"> SETL</FONT><FONT COLOR="#000000"> устанавливает </FONT><FONT COLOR="#0000BF">BL</FONT><FONT COLOR="#000000"> в 1. </FONT><FONT COLOR="#0000BF">DEC</FONT><FONT COLOR="#000000"> устанавливает </FONT><FONT COLOR="#0000BF">EBX</FONT><FONT COLOR="#000000"> в 0. Результат выполнения </FONT><FONT COLOR="#0000BF">AND</FONT> с операндами <FONT COLOR="#000000"></FONT><FONT COLOR="#0000BF">EBX</FONT><FONT COLOR="#000000"> и </FONT><FONT COLOR="#0000BF">C2</FONT><FONT COLOR="#000000"> есть 0 (</FONT><FONT COLOR="#0000BF">C1</FONT><FONT COLOR="#000000">). </FONT><P><FONT COLOR="#000000">При </FONT><FONT COLOR="#0000BF">A</FONT><FONT COLOR="#000000">>= </FONT><FONT COLOR="#0000BF">B&nbsp;</FONT><FONT COLOR="#000000"> </FONT><FONT COLOR="#0000BF">SETL</FONT><FONT COLOR="#000000"> устанавливает </FONT><FONT COLOR="#0000BF">BL</FONT><FONT COLOR="#000000"> в 0. </FONT><FONT COLOR="#0000BF">DEC</FONT><FONT COLOR="#000000"> устанавливает </FONT><FONT COLOR="#0000BF">EBX</FONT><FONT COLOR="#000000"> в -1 (</FONT><FONT COLOR="#0000BF">0xFFFFFFFF</FONT><FONT COLOR="#000000">). Результат выполнения </FONT><FONT COLOR="#0000BF">AND</FONT> с операндами <FONT COLOR="#000000"></FONT><FONT COLOR="#0000BF">EBX</FONT><FONT COLOR="#000000"> и </FONT><FONT COLOR="#0000BF">C2</FONT><FONT COLOR="#000000"> есть </FONT><FONT COLOR="#0000BF">C2</FONT><FONT COLOR="#000000">.</FONT><BR><BR><A HREF="#1">К началу страницы</A><BR><BR><BR><BR><BR><BR><BR><BR><BR><BR><BR><BR><BR><BR><BR><BR><BR><BR><BR><BR><BR><BR><BR><BR><BR><BR><BR><BR><BR><BR><BR><BR><A NAME="9"></a><FONT COLOR="#000000">При </FONT><FONT COLOR="#0000BF">C2-C1</FONT><FONT COLOR="#000000">= -1, -2, -4 или -8 замените </FONT><FONT COLOR="#0000BF">SETGE</FONT><FONT COLOR="#000000"> на </FONT><FONT COLOR="#0000BF">SETL</FONT><FONT COLOR="#000000">. Затем замените три последние команды на </FONT><FONT COLOR="#0000BF">LEA</FONT><FONT COLOR="#000000">. </FONT><FONT COLOR="#0000BF">SETL</FONT><FONT COLOR="#000000"> устанавливает </FONT><FONT COLOR="#0000BF">BL</FONT><FONT COLOR="#000000"> в 1 при </FONT><FONT COLOR="#0000BF">A</FONT><FONT COLOR="#000000">&lt; </FONT><FONT COLOR="#0000BF">B&nbsp;</FONT><FONT COLOR="#000000">и в 0 при </FONT><FONT COLOR="#0000BF">A</FONT><FONT COLOR="#000000"> >=</FONT><FONT COLOR="#0000BF">B</FONT><FONT COLOR="#000000">. При </FONT><FONT COLOR="#0000BF">BL</FONT><FONT COLOR="#000000">= 1&nbsp; </FONT><FONT COLOR="#0000BF">LEA</FONT><FONT COLOR="#000000"> устанавливает </FONT><FONT COLOR="#0000BF">EBX</FONT><FONT COLOR="#000000"> в </FONT><FONT COLOR="#0000BF">1*(C1-C2)+C2</FONT><FONT COLOR="#000000">= </FONT><FONT COLOR="#0000BF">C1</FONT><FONT COLOR="#000000">. При </FONT><FONT COLOR="#0000BF">BL</FONT><FONT COLOR="#000000">= 0&nbsp; </FONT><FONT COLOR="#0000BF">LEA</FONT><FONT COLOR="#000000"> устанавливает </FONT><FONT COLOR="#0000BF">EBX</FONT><FONT COLOR="#000000"> в </FONT><FONT COLOR="#0000BF">0*(C1-C2)+C2</FONT><FONT COLOR="#000000">= </FONT><FONT COLOR="#0000BF">C2</FONT><FONT COLOR="#000000">.</FONT><BR><BR><A HREF="#1">К началу страницы</A><BR><BR><BR><BR><BR><BR><BR><BR><BR><BR><BR><BR><BR><BR><BR><BR><BR><BR><BR><BR><BR><BR><BR><BR><BR><BR><BR><BR><BR><BR><BR><BR></BODY></HTML>